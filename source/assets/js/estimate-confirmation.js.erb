estimate_confirmation = function(bool){
  if(bool){
    $('#divYes').show()
    $('#divNo').hide()
  } else {
    $('#divNo').show()
    $('#divYes').hide()
  }
  $('#pConfirmationButtons').hide()
}

estimate_confirmation_cancel = function(){
  $('#divYes').hide()
  $('#divNo').hide()
  $('#pConfirmationButtons').show()
}


$('#frm-confirmation').validator().on('submit', function(e){
  if (e.isDefaultPrevented()) {
    alert("Please fill out all required fields - highlighted in red")
  } else {
    
  e.preventDefault()


  var token                    = $('#estimate_confirmation_token').val()
  var yes_or_no                = $('#divYes').is(':visible') ? 1 : 0
  var care_to_share            = $('#estimate_confirmation_care_to_share').val()
  var desired_appointment_date = $('#estimate_confirmation_desired_appointment_date').val()
  var details                  = $('#estimate_confirmation_details').val()

  var dContainer               = $('#confirmation-container')




  // Fixed last bug /sigh
  var data = {estimate_confirmation:{yes_or_no: yes_or_no, care_to_share: care_to_share, desired_appointment_date: desired_appointment_date, details: details}}
  
  var url = "http://<%=mblz_host%>/magic/invoices/" + token + "/estimate_confirmations"

  dContainer.fadeOut()

  $.ajax({
    type: "POST",
    url: url,
    data: data, //$(F).serialize(),
    success: function(msg){
       if(parseInt(msg)!=0)
       {
           //console.log(msg)
           dContainer.html(msg).fadeIn()
       }
    },
    error: function(){
      dContainer.html('Failed - we are sorry but something went wrong.').fadeIn()
    }
   });
  } 
})
